{% extends "master.html" %}

{% load static %}

{% block title %}
  Contract Admin
{% endblock %}

{% block content %}
<div style="
    position: absolute;
    top: 0;
    left: 10%;
    width: 90%;
    height: 100%;
    background-image: url('{% static "images/shadow_6.png" %}');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    z-index: -1;
">
    <div style="
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
    "></div>
</div>

<div style="display: flex; justify-content: center; align-items: center;">
    <h1 style="margin: 0px; color: white;">PRECAST APP HO</h1><img src="{% static 'logo.png' %}" alt="Your Image" style="width: 50px; height: 50px;"><h1 style="margin: 0px; color: white;">E PAGE</h1>
</div>
<p style="text-align:center; color: white;" >5/43 Accolade Avenue</p>

<!-- CSV Upload Form -->
<form action="{% url 'materials_upload' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" id="csv_file" name="csv_file" accept=".csv" style="display: none;" onchange="this.form.submit();">
    <button type="button" onclick="document.getElementById('csv_file').click();">Upload CSV</button>
</form>
<input type="file" id="csv_file" name="csv_file" accept=".csv" style="display: none;" onchange="this.form.submit();">

{{ suppliers|json_script:"suppliers" }}
{{ materials|json_script:"materials" }}

<script> // CSV Upload Script
    document.getElementById('csv_file').addEventListener('change', function(event) {
        var file = event.target.files[0];
        var reader = new FileReader();
        reader.onload = function(event) {
            var csvData = event.target.result;
            var lines = csvData.split('\n');
            var result = [];
            var headers = lines[0].split(',');

            for (var i = 1; i < lines.length; i++) {
                var obj = {};
                var currentline = lines[i].split(',');

                for (var j = 0; j < headers.length; j++) {
                    obj[headers[j]] = currentline[j];
                }

                result.push(obj);
            }

            fetch('{% url 'materials_upload' %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify(result)
            }).then(function(response) {
                if (response.ok) {
                    console.log('CSV file uploaded and processed successfully.');
                } else {
                    console.error('Error:', response.statusText);
                }
            }).catch(function(error) {
                console.error('Error:', error);
            });
        };

        reader.readAsText(file);
    });
</script>

<script>
    var suppliers = JSON.parse(document.getElementById('suppliers').textContent);
    suppliers.forEach(supplier => console.log(supplier));
    var materials = JSON.parse(document.getElementById('materials').textContent);
    materials.forEach(materials => console.log(materials));
</script>

<script src="{% static 'js/suppliers.js' %}"></script>
<script src="{% static 'js/materials.js' %}"></script>



{% endblock %}

